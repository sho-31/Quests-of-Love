<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cute Surprise ‚Äî Mad-Libs üíå</title>
<style>
  :root{
    --bg1: #fff3f8;
    --bg2: #ffe6f4;
    --accent: #ff1493;
    --accent-soft: #ff7ab2;
    --glass: rgba(255,255,255,0.6);
    --muted: #9c114a;
  }
  html,body{height:100%; margin:0; font-family:"Comic Sans MS", "Comic Sans", cursive, system-ui; -webkit-font-smoothing:antialiased;}
  body{
    background:
      radial-gradient(600px 300px at 10% 10%, rgba(255,255,255,0.35), transparent 8%),
      radial-gradient(500px 250px at 90% 80%, rgba(255,245,250,0.35), transparent 8%),
      linear-gradient(180deg,var(--bg1),var(--bg2));
    display:flex; align-items:center; justify-content:center;
    padding:28px;
    color:var(--muted);
    overflow-x:hidden;
  }

  /* Card */
  .card{
    width:100%; max-width:760px; border-radius:18px; padding:24px;
    background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,250,253,0.72));
    box-shadow: 0 18px 50px rgba(195,32,95,0.12);
    border:1px solid rgba(255,20,147,0.06);
    box-sizing:border-box;
    position:relative;
    overflow:visible;
  }

  header h1{
    margin:0 0 6px 0; font-size:2rem; color:var(--accent);
    text-shadow:0 0 16px rgba(255,105,180,0.12);
  }
  header p { margin:0 0 18px 0; font-size:1.05rem; line-height:1.5; color:#8f0f4c; }

  /* form layout */
  .fields{
    display:flex; gap:12px; flex-wrap:wrap; margin-bottom:14px; align-items:center;
  }
  .field{
    flex:1 1 200px; min-width:150px; display:flex; justify-content:center;
  }
  input[type="text"]{
    width:100%; max-width:100%; padding:12px 16px; font-size:1rem;
    border-radius:999px; border:2px solid rgba(255,20,147,0.12); text-align:center;
    background: rgba(255,255,255,0.92); box-shadow: inset 0 1px 0 rgba(255,255,255,0.6);
    outline:none; color:var(--muted);
    transition: box-shadow .18s ease, border-color .18s ease, transform .12s ease;
  }
  input[type="text"]:focus { border-color: rgba(255,20,147,0.28); box-shadow:0 6px 18px rgba(255,20,147,0.06); transform:translateY(-1px); }

  /* buttons */
  .controls{ display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap; margin-bottom:16px; }
  .btn{
    appearance:none; border:none; cursor:pointer; padding:11px 18px; font-size:1rem;
    border-radius:999px; color:white; background: linear-gradient(135deg,#ff7ab2,#ff2a96);
    box-shadow: 0 8px 26px rgba(255,20,147,0.16); transition: transform .16s ease, box-shadow .16s ease, opacity .12s ease;
  }
  .btn.secondary{ background: linear-gradient(135deg, rgba(255,255,255,0.14), rgba(255,255,255,0.04)); color:var(--accent); border:1px solid rgba(255,20,147,0.06); box-shadow: 0 6px 18px rgba(155,20,115,0.06); }
  .btn:active{ transform: translateY(1px); }
  .btn[disabled]{ opacity:0.6; cursor:progress; }

  /* result box */
  #result{
    margin-top:8px; padding:18px; border-radius:12px; min-height:70px; max-width:720px; margin-left:auto; margin-right:auto;
    background: linear-gradient(180deg, rgba(255,240,248,0.9), rgba(255,246,249,0.85));
    border:1px solid rgba(255,20,147,0.06); box-shadow: 0 12px 30px rgba(213,51,132,0.05);
    font-size:1.1rem; color:#8b0f4a; line-height:1.6; opacity:0; transform:translateY(8px);
    transition: opacity .32s ease, transform .32s ease;
    position:relative; overflow:visible;
    text-align:center;
  }
  #sentence{ font-weight:700; margin-bottom:8px; }
  #poem{ font-style:italic; color:#b71b62; }

  /* tiny hearts */
  .heart{
    position:absolute; font-size:18px; animation: heartUp 2s ease-out forwards; pointer-events:none; opacity:0.98;
  }
  @keyframes heartUp { 0%{ transform: translateY(0) scale(1); } 100%{ transform: translateY(-72px) scale(1.6); opacity:0; } }

  /* typing cursor for reveal */
  .typing { border-right: 2px solid rgba(139,15,74,0.9); padding-right:6px; animation: blink 1s steps(1) infinite; }
  @keyframes blink { 50%{ border-color: transparent; } }

  /* try again */
  #tryAgainBtn { display:none; margin-top:12px; }

  /* back link */
  .back { display:inline-block; margin-top:14px; color:var(--accent); text-decoration:none; font-weight:600; }

  /* small screens */
  @media (max-width:520px){
    header h1{ font-size:1.6rem; }
    .fields{ gap:10px; }
    #result{ font-size:1rem; padding:14px; }
  }
</style>
</head>
<body>

<div class="card" role="main" aria-labelledby="title">
  <header>
    <h1 id="title">Cute Surprise ‚Äî Mad-Libs üíå</h1>
    <p>Fill the blanks, or use Random Fill ‚Äî then let the page craft a short romantic line and a tiny poetic scene using puter.ai.</p>
  </header>

  <div class="fields" aria-hidden="false">
    <div class="field"><input id="adj" type="text" placeholder="Adjective (e.g., glowing)" aria-label="Adjective"></div>
    <div class="field"><input id="place" type="text" placeholder="Place (e.g., moonlit garden)" aria-label="Place"></div>
    <div class="field"><input id="noun" type="text" placeholder="Noun (e.g., rose)" aria-label="Noun"></div>
  </div>

  <div class="controls" role="group" aria-label="Mad Libs controls">
    <button id="randomBtn" class="btn secondary" title="Random Fill">Random Fill üé≤</button>
    <button id="generateBtn" class="btn" title="Write my love story">Write My Love Story ‚ú®</button>
    <button id="tryAgainBtn" class="btn secondary" title="Try again">Try Again üîÑ</button>
  </div>

  <div id="result" role="status" aria-live="polite">
    <div id="sentence" aria-atomic="true"></div>
    <div id="poem"></div>
  </div>

  <div style="text-align:center;">
    <a href="index.html" class="back">‚Üê Back to Main Page</a>
  </div>
</div>

<script src="https://js.puter.com/v2/"></script>
<script>
  // helpers
  const pickRandom = arr => arr[Math.floor(Math.random()*arr.length)];
  const adjInput = document.getElementById('adj');
  const placeInput = document.getElementById('place');
  const nounInput = document.getElementById('noun');
  const randomBtn = document.getElementById('randomBtn');
  const generateBtn = document.getElementById('generateBtn');
  const tryAgainBtn = document.getElementById('tryAgainBtn');
  const resultDiv = document.getElementById('result');
  const sentenceDiv = document.getElementById('sentence');
  const poemDiv = document.getElementById('poem');

  const randomWords = {
    adj: ["sparkling","glowing","gentle","soft","radiant","blushing","whispering","velvet"],
    place: ["moonlit garden","quiet beach","cozy caf√©","starlit meadow","rooftop at midnight","hidden porch"],
    noun: ["rose","letter","kiss","memory","butterfly","lantern"]
  };

  randomBtn.addEventListener('click', () => {
    adjInput.value = pickRandom(randomWords.adj);
    placeInput.value = pickRandom(randomWords.place);
    nounInput.value = pickRandom(randomWords.noun);
  });

  // lightweight confetti-ish hearts emitter (visual only)
  function emitHearts(count=6){
    for(let i=0;i<count;i++){
      const h = document.createElement('div');
      h.className = 'heart';
      h.textContent = 'üíñ';
      h.style.left = (20 + Math.random()*60) + '%';
      h.style.bottom = '8px';
      h.style.fontSize = (14 + Math.random()*26) + 'px';
      resultDiv.appendChild(h);
      setTimeout(()=> h.remove(), 2200 + Math.random()*800);
    }
  }

  // robust extraction from puter responses
  function extractText(resp){
    if(!resp) return '';
    if(typeof resp === 'string') return resp;
    try {
      if(resp.output_text && typeof resp.output_text === 'string') return resp.output_text;
      if(resp.output && Array.isArray(resp.output) && resp.output[0] && typeof resp.output[0] === 'object'){
        // some puter responses have output[0].content or output_text
        const out0 = resp.output[0];
        if(out0.content && typeof out0.content === 'string') return out0.content;
        if(out0.text && typeof out0.text === 'string') return out0.text;
      }
      if(resp.message && resp.message.content) {
        if(typeof resp.message.content === 'string') return resp.message.content;
        if(Array.isArray(resp.message.content)) return resp.message.content.map(x=> typeof x === 'string' ? x : (x.text||'')).join('\n');
      }
      // deep search for longest string
      let longest = '';
      (function walk(o){
        if(!o) return;
        if(typeof o === 'string'){ if(o.length > longest.length) longest = o; }
        else if(Array.isArray(o)) o.forEach(walk);
        else if(typeof o === 'object') Object.values(o).forEach(walk);
      })(resp);
      return longest;
    } catch(e){
      return '';
    }
  }

  function cleanText(s){
    if(!s) return '';
    return s.replace(/\\n/g,'\n').replace(/^\s+|\s+$/g,'').trim();
  }

  // typed reveal (per paragraph)
  async function typeReveal(targetEl, text, speed=12){
    targetEl.textContent = '';
    targetEl.classList.add('typing');
    for(let i=0;i<text.length;i++){
      targetEl.textContent += text[i];
      if(i % 5 === 0) await new Promise(r=>setTimeout(r, speed));
    }
    targetEl.classList.remove('typing');
  }

  // clicking generate
  generateBtn.addEventListener('click', async () => {
    const adj = adjInput.value.trim();
    const place = placeInput.value.trim();
    const noun = nounInput.value.trim();

    if(!adj || !place || !noun){
      sentenceDiv.textContent = "Please fill in all three fields ‚ù§Ô∏è";
      poemDiv.textContent = '';
      resultDiv.style.opacity = '1';
      resultDiv.style.transform = 'translateY(0)';
      return;
    }

    // UI: show status
    sentenceDiv.textContent = "Crafting something sweet... ‚ú®";
    poemDiv.textContent = '';
    resultDiv.style.opacity = '1';
    resultDiv.style.transform = 'translateY(0)';
    tryAgainBtn.style.display = 'none';
    generateBtn.disabled = true;
    randomBtn.disabled = true;

    // little heart animation
    emitHearts(4);

    // build prompt (kept focused + concise)
    const prompt = `
Inputs: ADJECTIVE = "{adj}", PLACE = "{place}", NOUN = "{noun}"

Write a short, poetic, romantic scene between Shourya and Divanshi addressed directly to Divanshi as "you". Use the three inputs naturally: include "{adj}" as an adjective, mention the place "{place}", and include the noun "{noun}" somewhere in the prose.

MANDATORY RULES:
- The very first sentence of the scene MUST begin with the words: "You and Shourya".
- Do NOT include any opening sentence or paragraph that begins with "The {adj}" or any other atmospheric line before the required "You and Shourya" sentence ‚Äî the scene must start immediately with "You and Shourya..."
- NEVER use first-person pronouns or possessives: do NOT use "I", "me", "my", "mine", "we", "our", "us", or contractions like "I'm", "we're".
- Address Divanshi using second-person "you" and "your" throughout.
- Refer to Shourya only by name ("Shourya") or by third-person pronouns ("he", "his"); do NOT use first-person for Shourya.
- Include the inputs exactly as provided: use "{adj}", "{place}", and "{noun}" somewhere in the scene.
- Do NOT include any signature or credit line (no "‚ÄîShourya" or similar).

STYLE & FORMAT:
- Tone: tender, dreamy, poetic, and human.
- Use vivid sensory details (light, touch, scent, sound) and short graceful sentences or very short paragraphs.
- Length: about 80‚Äì160 words total, formatted as 2‚Äì4 short paragraphs.
- Ending: finish with one tender closing line (a single final line). No signature, no extra lines.

OUTPUT:
Return ONLY the scene text (plain narrative, no headings, no explanations, no code).

`.trim();

    // call puter.ai.chat robustly
    let raw = null;
    try {
      if(window.puter && puter.ai && typeof puter.ai.chat === 'function'){
        // try simple style first (string prompt)
        try {
          raw = await puter.ai.chat(prompt, { model: "gpt-4.1-mini" });
        } catch(e1){
          // fallback: messages-based API (older style)
          raw = await puter.ai.chat({
            model: "gpt-4.1-mini",
            messages: [{ role:'system', content: 'You are a romantic storyteller. Keep it poetic and short.' }, { role:'user', content: prompt }]
          });
        }
      } else {
        // puter not available ‚Äî simulate delay for UX and throw to fallback
        await new Promise(r=>setTimeout(r, 800));
        throw new Error('Puter not available');
      }

      let extracted = extractText(raw);
      extracted = cleanText(extracted);

      // if API returns multiple lines, handle them
      let lines = extracted.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
      if(lines.length === 0){
        // fallback default short piece
        lines = ["You are a glowing secret that brightens every quiet night.","Beneath a soft sky, small lights gather like whispers of you."];
      }
      const first = lines[0];
      const second = lines.slice(1).join(' ') || '';

      // typed reveal
      await typeReveal(sentenceDiv, first, 10);
      if(second){
        await typeReveal(poemDiv, second, 12);
      } else {
        poemDiv.textContent = '';
      }

      tryAgainBtn.style.display = 'inline-block';
      generateBtn.disabled = false;
      randomBtn.disabled = false;
      emitHearts(6);
    } catch (err) {
      // graceful fallback text
      sentenceDiv.textContent = "You are my sweetest, simplest light. üíñ";
      poemDiv.textContent = "A small scene unfurls where your laugh softens the evening into something gentle.";
      tryAgainBtn.style.display = 'inline-block';
      generateBtn.disabled = false;
      randomBtn.disabled = false;
      console.warn('Mad-Libs error:', err);
    }
  });

  // try again simply re-triggers generate
  tryAgainBtn.addEventListener('click', () => {
    generateBtn.click();
  });

  // small accessibility: Enter key on inputs triggers generate
  [adjInput, placeInput, nounInput].forEach(inp => {
    inp.addEventListener('keydown', e => {
      if(e.key === 'Enter') generateBtn.click();
    });
  });

  // prefill with nice defaults for first visit
  if(!adjInput.value && !placeInput.value && !nounInput.value){
    adjInput.value = "glowing";
    placeInput.value = "moonlit garden";
    nounInput.value = "rose";
  }
</script>
</body>
</html>
