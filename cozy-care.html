<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üêæ Cozy Care ‚Äî Night Window</title>

  <!-- Tailwind utilities -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg-deep-1:#02061a;
      --bg-deep-2:#07112a;
      --accentA:#ff78b2;
      --accentB:#ff57a0;
      --glass: rgba(255,255,255,0.04);
      --muted:#b07aa6;
    }

    html,body{height:100%; margin:0;}
    body{
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background:
        radial-gradient(circle at 10% 10%, rgba(20,30,60,0.14), transparent 8%),
        radial-gradient(circle at 85% 85%, rgba(10,20,40,0.12), transparent 8%),
        linear-gradient(180deg, var(--bg-deep-1) 0%, var(--bg-deep-2) 50%, #020318 100%);
      color:#f5eaf6;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;
      justify-content:center;
      padding:18px;
      box-sizing:border-box;
    }

    /* container */
    .container{
      width:100%;
      max-width:1100px;
      display:grid;
      gap:18px;
      grid-template-columns: 1fr;
    }
    @media(min-width:940px){
      .container { grid-template-columns: 360px 1fr; }
    }

    /* glass card style */
    .card {
      border-radius: 14px;
      padding:14px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      box-shadow: 0 20px 60px rgba(0,0,0,0.6);
      border: 1px solid var(--glass);
    }

    /* header */
    .title {
      font-family: 'Pacifico', cursive;
      font-size: clamp(1.2rem, 3.6vw, 1.9rem);
      color:#ffdff8;
      margin:0;
      text-align:center;
      text-shadow: 0 8px 40px rgba(255,90,160,0.06);
    }

    .muted {
      color: var(--muted);
    }

    /* book */
    .book { width:140px; height:92px; margin:14px auto; perspective:1000px; cursor:pointer; }
    .book-shell {
      width:100%; height:100%; border-radius:10px; transform-origin:left center;
      transition: transform 520ms cubic-bezier(.2,.9,.2,1);
      background: linear-gradient(180deg,#ffeaf4,#ffdbe9);
      box-shadow: 0 12px 30px rgba(0,0,0,0.6);
      border:1px solid rgba(255,255,255,0.06);
      position:relative;
    }
    .book.open .book-shell { transform: rotateY(-18deg) translateX(-6px) scale(1.02); }
    .book .label { position:absolute; right:12px; top:34px; font-weight:700; color:#2b1422; }

    /* flipbook pages (Surprise, Affirm) */
    .flipbook { width:300px; max-width:100%; height:220px; margin:auto; position:relative; perspective:1200px; }
    .page{
      position:absolute; inset:0; border-radius:12px; padding:12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      transition: transform 600ms cubic-bezier(.2,.9,.2,1), opacity 320ms;
      box-shadow: inset 0 -8px 30px rgba(0,0,0,0.55);
      display:flex; flex-direction:column; gap:8px; backface-visibility:hidden;
      color:#ffeef8;
    }
    .page.p1 { z-index:40; transform-origin:left center; }
    .page.p2 { z-index:30; left:6px; top:6px; width:calc(100% - 6px); transform-origin:left center; }
    .page.p3 { z-index:20; left:12px; top:12px; width:calc(100% - 12px); transform-origin:left center; }
    .page.flipped { transform: rotateY(-160deg) translateX(-60px); opacity:0; }

    /* Window / sky */
    .window { border-radius:12px; padding:12px; overflow:visible; }
    .sky {
      position:relative;
      width:100%;
      min-height:420px;
      border-radius:12px;
      background: radial-gradient(circle at 40% 18%, #0d2a4a 0%, #07102a 36%, #020318 100%);
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    /* star (twinkle) */
    .star {
      position:absolute;
      width:3px; height:3px; border-radius:50%;
      background: white; opacity:0.9;
      filter: drop-shadow(0 0 6px rgba(255,255,255,0.7));
      animation: twinkle linear infinite;
    }
    @keyframes twinkle {
      0% { transform: scale(0.6); opacity: 0.18; }
      50% { transform: scale(1); opacity: 1; }
      100% { transform: scale(0.6); opacity: 0.18; }
    }

    /* orbit nodes */
    .orbit-wrap { position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); width:520px; height:520px; pointer-events:none; }
    .node {
      position:absolute; width:56px; height:56px; border-radius:999px;
      display:flex; align-items:center; justify-content:center;
      background: radial-gradient(circle at 30% 30%, #133457, #08162a);
      color:#fbeefb; font-weight:700;
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
      cursor:pointer; pointer-events:auto;
      transition: transform .36s cubic-bezier(.2,.9,.2,1), box-shadow .36s;
    }
    .node:hover { transform: translateY(-6px) scale(1.05); box-shadow: 0 28px 70px rgba(0,0,0,0.6); }

    /* breathing */
    .breath {
      width:240px; height:240px; border-radius:999px;
      display:flex; align-items:center; justify-content:center;
      background: radial-gradient(circle at 35% 28%, rgba(255,255,255,0.02), rgba(255,245,250,0.02) 30%, rgba(10,24,50,0.14) 100%);
      box-shadow: 0 24px 70px rgba(0,0,0,0.6), inset 0 8px 18px rgba(255,255,255,0.02);
      transition: transform 7000ms cubic-bezier(.2,.9,.2,1);
      will-change: transform;
      position:relative;
    }
    .breath.small { transform: scale(0.78); }
    .breath.big { transform: scale(1.18); }
    .breath.contract { transform: scale(0.78); transition-duration:4000ms; }

    .paw-center { width:120px; height:120px; pointer-events:none; display:block; }
    .paw-center img { width:100%; height:100%; object-fit:contain; display:block; filter: drop-shadow(0 16px 28px rgba(0,0,0,0.6)); }

    .float-paw { position:absolute; font-size:18px; pointer-events:none; transform: translateY(0) scale(.9); opacity:1; }

    .affirm {
      background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      padding:12px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.02);
      text-align:center;
      color:#ffdff8;
      font-weight:700;
    }

    @media(max-width:640px){
      .orbit-wrap { width:380px; height:380px; }
      .breath { width:170px; height:170px; }
      .paw-center { width:86px; height:86px; }
      .flipbook { width:260px; height:180px; }
    }
  </style>
</head>
<body>

  <main class="container">

    <!-- LEFT column -->
    <section class="flex flex-col gap-4">
      <div class="card">
        <h1 class="title">üêæ Cozy Room</h1>
        <p class="muted mt-2 text-sm">Tap the dreambook or a planet in the sky. The breathing circle sits in the center ‚Äî try it.</p>
      </div>

      <div class="card">
        <div class="book" id="book" aria-pressed="false" role="button" tabindex="0" title="Open Dreambook">
          <div class="book-shell">
            <div class="label">Dreambook</div>
          </div>
        </div>

        <div class="flipbook mt-2" id="flipbook" aria-hidden="true">
          <div class="page p3" id="page3">
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <div style="font-weight:700">Surprise</div>
              <div style="font-size:0.9rem" class="muted">Peek</div>
            </div>
            <div style="flex:1;display:flex;align-items:center;justify-content:center;color:#d6c0d7;">
              Tiny surprises live here ‚ú®
            </div>
          </div>

          <div class="page p2" id="page2">
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <div style="font-weight:700">Affirmations</div>
              <div style="font-size:0.9rem" class="muted">Auto</div>
            </div>
            <div style="flex:1;display:flex;align-items:center;justify-content:center;">
              <div class="affirm" id="flipAff">You are loved and cherished üå∏</div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="flex flex-col items-center gap-3">
          <div class="muted text-sm text-center">Tip: tap a star (planet) to focus a feature.</div>
        </div>
      </div>
    </section>

    <!-- RIGHT column -->
    <section>
      <div class="card window">
        <div class="sky" id="sky">

          <!-- orbit wrapper -->
          <div class="orbit-wrap" id="orbitWrap" aria-hidden="true"></div>

          <!-- breathing center -->
          <div id="breath" class="breath small" aria-label="breathing circle">
            <div class="paw-center">
              <img id="pawImg" src="paw.png" alt="paw" onerror="console.warn('paw.png missing ‚Äî add paw.png next to this HTML file')">
            </div>
          </div>

          <!-- animation layer -->
          <div id="animLayer" style="position:absolute;inset:0;pointer-events:none;"></div>
        </div>

        <!-- controls -->
        <div class="flex gap-4 justify-center mt-4">
          <button id="btnStart" class="px-5 py-2 rounded-full" style="background:linear-gradient(90deg,var(--accentA),var(--accentB)); color:white; font-weight:800; box-shadow:0 10px 30px rgba(255,90,150,0.12)">Start Breathing</button>
          <button id="btnHow" class="px-4 py-2 rounded-full" style="background:transparent;border:1px solid rgba(255,255,255,0.06);color:#ffdff7;font-weight:700">How to</button>
        </div>
      </div>

      <div class="card mt-4">
        <h3 style="margin:0;font-weight:700;">üí¨ Gentle Affirmation</h3>
        <div style="margin-top:10px;">
          <div class="affirm" id="mainAff">Every breath you take brings peace üå¨</div>
          <div class="muted text-sm mt-2" style="text-align:center;">(automatically changes every 5 seconds)</div>
        </div>
      </div>
    </section>

  </main>

  <footer></footer>

  <script>
    /* ---------------------------
       Starfield (lightweight)
       --------------------------- */
    const sky = document.getElementById('sky');
    const animLayer = document.getElementById('animLayer');

    function createStar(left, top, size, dur, delay) {
      const s = document.createElement('div');
      s.className = 'star';
      s.style.left = left + '%';
      s.style.top = top + '%';
      s.style.width = s.style.height = size + 'px';
      s.style.animationDuration = dur + 'ms';
      s.style.animationDelay = delay + 'ms';
      animLayer.appendChild(s);
      return s;
    }

    function populateStars(count = 120) {
      for (let i=0; i<count; i++){
        const left = Math.random()*100;
        const top = Math.random()*86;
        const size = 1 + Math.random()*3.5;
        const dur = 1400 + Math.random()*3000;
        const delay = Math.random()*2000;
        createStar(left, top, size, dur, delay);
      }
    }
    populateStars(120);

    /* ---------------------------
       Orbiting nodes (planets)
       --------------------------- */
    const orbitWrap = document.getElementById('orbitWrap');
    const nodes = [
      {id:'n-breathe', label:'Breathe', angle:-10, r:150},
      {id:'n-affirm', label:'Affirm', angle:70, r:190},
      {id:'n-surprise', label:'Surprise', angle:160, r:150},
      {id:'n-note', label:'Notes', angle:250, r:180}
    ];

    // create nodes
    nodes.forEach(n => {
      const el = document.createElement('div');
      el.className = 'node';
      el.id = n.id;
      el.innerHTML = `<div class="label">${n.label}</div>`;
      orbitWrap.appendChild(el);
      el.addEventListener('click', ()=> focusNode(n.id));
    });

    // smooth RAF loop for orbit
    let orbitAngle = 0;
    let lastRAF = performance.now();
    function orbitLoop(now){
      const dt = Math.min(40, now - lastRAF);
      lastRAF = now;
      orbitAngle += 0.00025 * dt;
      nodes.forEach((n,i) => {
        const el = document.getElementById(n.id);
        const base = (n.angle || 0) * Math.PI/180;
        const a = base + orbitAngle + (i * 0.03);
        const r = n.r;
        const cx = orbitWrap.clientWidth/2;
        const cy = orbitWrap.clientHeight/2;
        const x = cx + Math.cos(a) * r;
        const y = cy + Math.sin(a) * r;
        el.style.left = x + 'px';
        el.style.top = y + 'px';
      });
      requestAnimationFrame(orbitLoop);
    }
    requestAnimationFrame(orbitLoop);

    /* ---------------------------
       Flipbook toggle
       --------------------------- */
    const book = document.getElementById('book');
    const page1 = document.getElementById('page1');
    const page2 = document.getElementById('page2');
    const page3 = document.getElementById('page3');
    let bookOpen = false;
    book.addEventListener('click', ()=> {
      bookOpen = !bookOpen;
      book.classList.toggle('open', bookOpen);
      if (bookOpen) {
        page1.classList.remove('flipped'); page2.classList.remove('flipped'); page3.classList.remove('flipped');
        setTimeout(()=> page1.classList.add('flipped'), 1100);
        setTimeout(()=> page2.classList.add('flipped'), 1700);
        setTimeout(()=> page3.classList.add('flipped'), 2300);
      } else {
        page1.classList.remove('flipped'); page2.classList.remove('flipped'); page3.classList.remove('flipped');
      }
    });

    /* ---------------------------
       Affirmations auto-rotate
       --------------------------- */
    const affirmList = [
      "Every breath you take brings peace üå¨",
      "You are doing amazing, Divanshi üíõ",
      "You are loved and cherished üå∏",
      "You make tiny moments feel like magic ‚ú®",
      "You are exactly where you need to be üíó"
    ];
    const mainAff = document.getElementById('mainAff');
    const flipAff = document.getElementById('flipAff');
    let ai = 0;
    let affHandle = setInterval(rotateAff, 5000);
    function rotateAff(){
      ai = (ai + 1) % affirmList.length;
      mainAff.classList.remove('aff-in'); mainAff.classList.add('aff-out');
      setTimeout(()=> {
        mainAff.textContent = affirmList[ai];
        mainAff.classList.remove('aff-out'); mainAff.classList.add('aff-in');
      }, 360);
      flipAff.textContent = affirmList[(ai+2) % affirmList.length];
    }
    document.addEventListener('visibilitychange', ()=> {
      if (document.hidden) { clearInterval(affHandle); affHandle = null; }
      else if (!affHandle) affHandle = setInterval(rotateAff, 5000);
    });

    /* ---------------------------
       Breathing sequence (7s inhale / 8s hold / 4s exhale)
       --------------------------- */
    const breathEl = document.getElementById('breath');
    const btnStart = document.getElementById('btnStart');
    const btnHow = document.getElementById('btnHow');

    const inhaleMs = 7000, holdMs = 8000, exhaleMs = 4000;
    let breathing = false, breathTimer = null;

    // resting orientation
    breathEl.classList.add('small');

    function spawnFloatingPaws(count=6){
      for (let i=0;i<count;i++){
        const el = document.createElement('div');
        el.className = 'float-paw';
        el.textContent = 'üêæ';
        const leftPct = 48 + (Math.random()-0.5)*18;
        const topPct = 48 + (Math.random()-0.5)*16;
        el.style.left = leftPct + '%';
        el.style.top = topPct + '%';
        animLayer.appendChild(el);

        if (el.animate) {
          const dx = (-60 + Math.random()*120);
          const dy = -(100 + Math.random()*60);
          const dur = 1200 + Math.random()*500;
          el.animate([
            { transform: 'translate(0px, 0px) scale(.95)', opacity: 1 },
            { transform: `translate(${dx}px, ${dy}px) scale(1)`, opacity: 0 }
          ], { duration: dur, easing: 'cubic-bezier(.2,.9,.2,1)', fill:'forwards' }).onfinish = ()=> el.remove();
        } else {
          requestAnimationFrame(()=> {
            el.style.transition = 'transform 1200ms cubic-bezier(.2,.9,.2,1), opacity 1200ms';
            const dx = (-60 + Math.random()*120);
            const dy = -(100 + Math.random()*60);
            el.style.transform = `translate(${dx}px, ${dy}px) scale(1)`;
            el.style.opacity = '0';
            setTimeout(()=> el.remove(), 1500);
          });
        }
      }
    }

    async function breatheLoop(){
      if (!breathing) return;
      // inhale
      breathEl.style.transitionDuration = inhaleMs + 'ms';
      breathEl.classList.add('big'); breathEl.classList.remove('small','contract');
      await new Promise(r => breathTimer = setTimeout(r, inhaleMs));
      if (!breathing) return;
      // hold
      await new Promise(r => breathTimer = setTimeout(r, holdMs));
      if (!breathing) return;
      // exhale
      breathEl.style.transitionDuration = exhaleMs + 'ms';
      breathEl.classList.add('contract'); breathEl.classList.remove('big','small');
      spawnFloatingPaws(6);
      await new Promise(r => breathTimer = setTimeout(r, exhaleMs));
      if (!breathing) return;
      // rest
      breathEl.classList.remove('contract'); breathEl.classList.add('small');
      await new Promise(r => breathTimer = setTimeout(r, 300));
      if (!breathing) return;
      breatheLoop();
    }

    btnStart.addEventListener('click', ()=> {
      if (!breathing) {
        breathing = true;
        btnStart.textContent = 'Stop Breathing';
        breatheLoop();
      } else {
        breathing = false;
        btnStart.textContent = 'Start Breathing';
        clearTimeout(breathTimer);
        breathEl.classList.remove('big','contract'); breathEl.classList.add('small');
      }
    });
    btnHow.addEventListener('click', ()=> {
      alert('Follow the circle:\nInhale ‚Äî 7 seconds\nHold ‚Äî 8 seconds\nExhale ‚Äî 4 seconds\nRepeat gently.');
    });

    /* ---------------------------
       Focus node behavior
       --------------------------- */
    function focusNode(id){
      const el = document.getElementById(id);
      if (!el) return;
      el.style.transform = 'scale(1.12) translateY(-6px)';
      setTimeout(()=> el.style.transform = '', 650);
      if (id === 'n-breathe') {
        breathEl.scrollIntoView({behavior:'smooth', block:'center'});
        setTimeout(()=> { if (!breathing) btnStart.click(); }, 700);
      } else if (id === 'n-affirm') {
        rotateAff();
      } else if (id === 'n-surprise') {
        if (!book.classList.contains('open')) book.click();
        page3.style.transform = 'translateY(6px)';
        setTimeout(()=> page3.style.transform = '', 1200);
      } else if (id === 'n-note') {
        if (!book.classList.contains('open')) book.click();
        page2.style.transform = 'translateY(6px)';
        setTimeout(()=> page2.style.transform = '', 1000);
      }
    }

    // safety on hide
    document.addEventListener('visibilitychange', ()=> {
      if (document.hidden) { breathing=false; clearTimeout(breathTimer); }
    });

    // initialize small/rest
    window.addEventListener('load', ()=> {
      breathEl.classList.add('small');
      page1.classList.add('flipped'); page2.classList.add('flipped'); page3.classList.add('flipped');
    });
  </script>
</body>
</html>
