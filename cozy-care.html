<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üêæ Cozy Care ‚Äî Night Window</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --indigo-1: #07061a;
      --indigo-2: #0d1b3a;
      --accentA: #ff78b2;
      --accentB: #ff57a0;
      --muted: #9a4a7a;
    }

    html,body{height:100%; margin:0;}
    body{
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background: linear-gradient(180deg, #0f1020 0%, #111422 30%, #0b1228 100%);
      color: #eee7f2;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex; justify-content:center; padding:20px;
      box-sizing:border-box;
    }

    .container {
      width:100%;
      max-width:1100px;
      display:grid;
      grid-template-columns: 1fr;
      gap:18px;
    }
    @media(min-width:940px){
      .container { grid-template-columns:360px 1fr; }
    }

    /* left controls */
    .panel {
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      border-radius: 16px;
      padding:14px;
      border: 1px solid rgba(255,255,255,0.04);
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
    }
    h1.title {
      font-family: 'Pacifico', cursive;
      font-size:1.55rem;
      margin:0;
      color:#ffdff0;
      text-align:center;
      text-shadow: 0 6px 28px rgba(255,100,175,0.08);
    }
    .muted { color: var(--muted); }

    /* book */
    .book {
      width:140px; height:94px; margin:auto; position:relative; perspective:1000px;
      cursor:pointer;
    }
    .book-shell {
      width:100%; height:100%; border-radius:9px; position:relative;
      transform-origin: left center;
      transition: transform 520ms cubic-bezier(.2,.9,.2,1);
      box-shadow: 0 12px 30px rgba(0,0,0,0.6);
      background: linear-gradient(180deg,#ffecf6,#ffdfee);
      border:1px solid rgba(255,255,255,0.06);
    }
    .book.open .book-shell { transform: rotateY(-18deg) translateX(-6px) scale(1.02); }

    .book .label { position:absolute; right:10px; top:30px; font-weight:700; color:#2b1422; font-size:0.9rem; }

    /* flipbook pages */
    .flipbook {
      width:300px; height:220px; margin:auto; position:relative; perspective:1200px;
    }
    .page {
      position:absolute; inset:0; border-radius:12px; padding:12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      color:#ffeef7;
      transition: transform 600ms cubic-bezier(.2,.9,.2,1), opacity 320ms;
      box-shadow: inset 0 -8px 30px rgba(0,0,0,0.6);
      display:flex; flex-direction:column; gap:8px;
      backface-visibility: hidden;
    }
    .page.p1 { z-index:40; transform-origin:left center; }
    .page.p2 { z-index:30; left:6px; top:6px; width:calc(100% - 6px); transform-origin:left center; }
    .page.p3 { z-index:20; left:12px; top:12px; width:calc(100% - 12px); transform-origin:left center; }

    .page.flipped { transform: rotateY(-160deg) translateX(-60px); opacity:0; }

    /* main window / sky */
    .window {
      border-radius:16px;
      padding:18px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.03);
      box-shadow: 0 18px 48px rgba(0,0,0,0.6);
      overflow:visible;
    }

    .sky {
      position:relative;
      width:100%;
      min-height:360px;
      border-radius:12px;
      background: radial-gradient(circle at 60% 30%, #10203f 0%, #07102a 40%, #02061a 100%);
      overflow:hidden;
      display:flex; align-items:center; justify-content:center;
    }

    /* twinkling stars (CSS keyframes for smooth low-cost animation) */
    .star {
      position:absolute; width:3px; height:3px; border-radius:50%;
      background: white; opacity:0.8;
      filter: drop-shadow(0 0 6px rgba(255,255,255,0.65));
      animation: twinkle linear infinite;
    }
    @keyframes twinkle {
      0% { opacity: 0.15; transform: scale(0.7); }
      50% { opacity: 1; transform: scale(1); }
      100% { opacity: 0.15; transform: scale(0.7); }
    }

    /* orbit + nodes */
    .orbit-wrap{ position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); width:520px; height:520px; pointer-events:none; }
    .node {
      position:absolute;
      width:56px; height:56px; border-radius:999px;
      display:flex; align-items:center; justify-content:center;
      background: linear-gradient(180deg,#081a3a, #12284d);
      color:#fbeefb; font-weight:700; cursor:pointer; pointer-events:auto;
      box-shadow: 0 8px 20px rgba(0,0,0,0.6);
      transition: transform .36s cubic-bezier(.2,.9,.2,1), box-shadow .36s;
    }
    .node:hover{ transform: translateY(-6px) scale(1.05); box-shadow: 0 20px 48px rgba(0,0,0,0.6); }

    /* breathing center */
    .breath {
      width:220px; height:220px; border-radius:999px;
      display:flex; align-items:center; justify-content:center;
      background: radial-gradient(circle at 35% 28%, rgba(255,255,255,0.02), rgba(255,245,250,0.03) 30%, rgba(20,40,70,0.12) 100%);
      box-shadow: 0 18px 48px rgba(10,10,30,0.6), inset 0 8px 18px rgba(255,255,255,0.02);
      transition: transform 7000ms cubic-bezier(.2,.9,.2,1);
      will-change: transform;
      position:relative;
      overflow:visible;
    }
    .breath.small { transform: scale(0.78); }
    .breath.big { transform: scale(1.18); }
    .breath.contract { transform: scale(0.78); transition-duration:4000ms; }

    .paw-center { width:110px; height:110px; pointer-events:none; display:block; }
    .paw-center img { width:100%; height:100%; object-fit:contain; display:block; filter: drop-shadow(0 20px 30px rgba(0,0,0,0.6)); }

    /* floating paw prints with smooth WA API fallback */
    .float-paw { position:absolute; font-size:18px; pointer-events:none; transform: translateY(0) scale(.8); opacity:1; }

    /* affirmation box */
    .affirm { background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:12px; border-radius:10px; border:1px solid rgba(255,255,255,0.03); text-align:center; color:#ffdfeff; font-weight:600; }

    @media (max-width:640px){
      .orbit-wrap{ width:360px; height:360px; }
      .breath{ width:170px; height:170px; }
      .paw-center{ width:86px; height:86px; }
      .page { font-size:0.95rem; }
    }

    /* subtle footer spacing */
    footer{ height:20px; }
  </style>
</head>
<body>

  <div class="container">

    <!-- left column -->
    <div class="flex flex-col gap-4">
      <div class="panel">
        <h1 class="title">üêæ Cozy Room</h1>
        <p class="muted mt-2 text-sm">Tap the book, the stars, or the window to begin. Designed to be calm and low-CPU.</p>
      </div>

      <div class="panel">
        <div class="book" id="book">
          <div class="book-shell" id="bookShell">
            <div class="label">Dreambook</div>
          </div>
        </div>

        <div class="mt-4 flipbook" id="flipbook">
          <div class="page p3" id="page3">
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <div style="font-weight:700">Surprise</div>
              <div style="font-size:0.9rem" class="muted">Peek</div>
            </div>
            <div style="flex:1; display:flex; align-items:center; justify-content:center; color:#d6c0d7;">
              Little notes & tiny surprises ‚ú®
            </div>
          </div>
          <div class="page p2" id="page2">
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <div style="font-weight:700">Affirmations</div>
              <div style="font-size:0.9rem" class="muted">Auto</div>
            </div>
            <div style="flex:1; display:flex; align-items:center; justify-content:center;">
              <div class="affirm" id="flipAff">You are loved and cherished üå∏</div>
            </div>
          </div>
          <div class="page p1" id="page1">
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <div style="font-weight:700">Playlist</div>
              <div style="font-size:0.9rem" class="muted">Play</div>
            </div>
            <div style="margin-top:8px;">
              <iframe id="miniSpotify" style="width:100%; height:78px; border-radius:10px; border:none;" src="https://open.spotify.com/embed/playlist/37i9dQZF1DWU0ScTcjJBdj" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>
            </div>
          </div>
        </div>

      </div>

      <div class="panel">
        <div style="display:flex;flex-direction:column;gap:8px;align-items:center;">
          <button class="px-4 py-2 rounded-full" style="background:linear-gradient(90deg,var(--accentA),var(--accentB)); color:white; font-weight:700; box-shadow:0 8px 28px rgba(255,90,150,0.12)" onclick="openPlaylist()">Open Playlist</button>
          <div class="muted text-sm mt-2">Or tap a star to focus a feature.</div>
        </div>
      </div>
    </div>

    <!-- right column: window + interactions -->
    <div class="">
      <div class="panel window">
        <div class="sky" id="sky">

          <!-- orbit wrap for nodes -->
          <div class="orbit-wrap" id="orbitWrap"></div>

          <!-- breathing center -->
          <div id="breath" class="breath small" aria-label="Breathing circle">
            <div class="paw-center">
              <img id="pawImg" src="paw.png" alt="paw" onerror="console.warn('paw.png missing ‚Äî add file named paw.png next to cozy-care.html')">
            </div>
          </div>

          <!-- anim layer for stars and paw floats -->
          <div id="animLayer" style="position:absolute; inset:0; pointer-events:none;"></div>

        </div>

        <!-- control buttons -->
        <div class="flex gap-4 justify-center mt-4">
          <button id="btnStart" class="px-5 py-2 rounded-full" style="background:linear-gradient(90deg,var(--accentA),var(--accentB)); color:white; font-weight:700; box-shadow:0 10px 30px rgba(255,90,150,0.12)">Start Breathing</button>
          <button id="btnHow" class="px-4 py-2 rounded-full" style="background:transparent; border:1px solid rgba(255,255,255,0.06); color:#ffdfeff; font-weight:700">How to</button>
        </div>
      </div>

      <div class="panel mt-4">
        <h3 style="margin:0;font-weight:700;">üí¨ Gentle Affirmation</h3>
        <div style="margin-top:10px;">
          <div class="affirm" id="mainAff">Every breath you take brings peace üå¨</div>
          <div class="muted text-sm mt-2" style="text-align:center;">(changes every 5 seconds)</div>
        </div>
      </div>
    </div>

  </div>

  <footer></footer>

<script>
/* -------------------------
  Utilities / fallback
------------------------- */
function openPlaylist(){
  window.open('https://open.spotify.com/playlist/37i9dQZF1DWU0ScTcjJBdj', '_blank');
}

/* -------------------------
  Create twinkling stars (CSS animation is used, JS positions them)
------------------------- */
const animLayer = document.getElementById('animLayer');
const sky = document.getElementById('sky');
function makeStars(count = 40){
  const w = sky.clientWidth, h = sky.clientHeight;
  for (let i=0;i<count;i++){
    const s = document.createElement('div');
    s.className = 'star';
    // random position
    const left = Math.random()*100;
    const top = Math.random()*85;
    s.style.left = left + '%';
    s.style.top = top + '%';
    // varied size & animation duration
    const size = 1 + Math.random()*3;
    s.style.width = s.style.height = size + 'px';
    const dur = 1800 + Math.random()*2400;
    s.style.animationDuration = dur + 'ms';
    s.style.animationDelay = (Math.random()*1200) + 'ms';
    animLayer.appendChild(s);
  }
}
/* create stars once (responsive safe) */
makeStars(48);

/* -------------------------
  Orbit nodes creation + smooth RAF loop
------------------------- */
const orbitWrap = document.getElementById('orbitWrap');
const nodes = [
  {id:'n-play', label:'Play', angle:-25, r:140},
  {id:'n-breathe', label:'Breathe', angle:75, r:165},
  {id:'n-affirm', label:'Affirm', angle:165, r:135},
  {id:'n-surprise', label:'Surprise', angle:255, r:155}
];

nodes.forEach((n, idx) => {
  const el = document.createElement('div');
  el.className = 'node';
  el.id = n.id;
  el.innerHTML = `<div class="label">${n.label}</div>`;
  orbitWrap.appendChild(el);
  el.addEventListener('click', ()=> focusNode(n.id));
});

let orbitAngle = 0;
let lastRAF = performance.now();
function orbitLoop(now){
  const dt = Math.min(40, now - lastRAF); // cap dt
  lastRAF = now;
  // slow angular speed, scaled with dt
  orbitAngle += 0.00028 * dt; // tuned slower and smoother
  nodes.forEach((n,i) => {
    const el = document.getElementById(n.id);
    const base = (n.angle||0) * Math.PI/180;
    const a = base + orbitAngle + (i * 0.08);
    const r = n.r;
    const cx = orbitWrap.clientWidth/2;
    const cy = orbitWrap.clientHeight/2;
    const x = cx + Math.cos(a) * r;
    const y = cy + Math.sin(a) * r;
    // apply transform
    el.style.left = x + 'px';
    el.style.top = y + 'px';
  });
  requestAnimationFrame(orbitLoop);
}
requestAnimationFrame(orbitLoop);

/* -------------------------
  Flipbook simplified toggle (no racing)
------------------------- */
const book = document.getElementById('book');
const bookShell = document.getElementById('bookShell');
const page1 = document.getElementById('page1');
const page2 = document.getElementById('page2');
const page3 = document.getElementById('page3');
let open = false;
book.addEventListener('click', () => {
  open = !open;
  book.classList.toggle('open', open);
  // pages flip in sequence but without tangled timeouts
  if (open) {
    page1.classList.remove('flipped');
    page2.classList.remove('flipped');
    page3.classList.remove('flipped');
    // small staged effect (non-blocking)
    setTimeout(()=> page1.classList.add('flipped'), 1200);
    setTimeout(()=> page2.classList.add('flipped'), 1800);
    setTimeout(()=> page3.classList.add('flipped'), 2400);
  } else {
    page1.classList.remove('flipped');
    page2.classList.remove('flipped');
    page3.classList.remove('flipped');
  }
});

/* -------------------------
  Affirmations auto-rotate (main + flip small)
------------------------- */
const affirmList = [
  "Every breath you take brings peace üå¨",
  "You are doing amazing, Divanshi üíõ",
  "You are loved and cherished üå∏",
  "You make tiny moments feel like magic ‚ú®",
  "You are exactly where you need to be üíó"
];
const mainAff = document.getElementById('mainAff');
const flipAff = document.getElementById('flipAff');
let ai = 0;
let affHandle = setInterval(rotateAff, 5000);
function rotateAff(){
  ai = (ai + 1) % affirmList.length;
  // crossfade main
  mainAff.classList.remove('aff-in'); mainAff.classList.add('aff-out');
  setTimeout(()=> {
    mainAff.textContent = affirmList[ai];
    mainAff.classList.remove('aff-out'); mainAff.classList.add('aff-in');
  }, 320);
  // mini flipbook snippet
  flipAff.textContent = affirmList[(ai+2) % affirmList.length];
}
document.addEventListener('visibilitychange', ()=> {
  if (document.hidden) { clearInterval(affHandle); affHandle = null; }
  else if (!affHandle) affHandle = setInterval(rotateAff, 5000);
});

/* -------------------------
  Breathing logic (smooth)
------------------------- */
const breathEl = document.getElementById('breath');
const btnStart = document.getElementById('btnStart');
const btnHow = document.getElementById('btnHow');

const inhaleMs = 7000, holdMs = 8000, exhaleMs = 4000;
let breathing = false, breathTimer = null;

// set to rest
breathEl.classList.add('small');

function spawnFloatingPaws(count=6){
  // use Web Animations API for stable timing where available
  for (let i=0;i<count;i++){
    const el = document.createElement('div');
    el.className = 'float-paw';
    el.textContent = 'üêæ';
    // random start near center
    const leftPct = 48 + (Math.random()-0.5)*14;
    const topPct = 48 + (Math.random()-0.5)*12;
    el.style.left = leftPct + '%';
    el.style.top = topPct + '%';
    el.style.opacity = '1';
    el.style.transform = 'translateY(0) scale(.9)';
    animLayer.appendChild(el);

    // animate using WA API if available; otherwise fallback to transition
    if (el.animate){
      const dx = (-50 + Math.random()*100);
      const dy = -(80 + Math.random()*60);
      el.animate([
        { transform: 'translate(0px, 0px) scale(.95)', opacity: 1 },
        { transform: `translate(${dx}px, ${dy}px) scale(1)`, opacity: 0 }
      ], {
        duration: 1200 + Math.random()*400,
        easing: 'cubic-bezier(.2,.9,.2,1)',
        fill: 'forwards'
      }).onfinish = () => { try{ el.remove(); } catch(e){} };
    } else {
      // fallback
      requestAnimationFrame(()=> {
        el.style.transition = 'transform 1200ms cubic-bezier(.2,.9,.2,1), opacity 1200ms';
        const dx = (-50 + Math.random()*100);
        const dy = -(80 + Math.random()*60);
        el.style.transform = `translate(${dx}px, ${dy}px) scale(1)`;
        el.style.opacity = '0';
        setTimeout(()=> { try{ el.remove(); } catch(e){} }, 1500);
      });
    }
  }
}

async function breatheLoop(){
  if (!breathing) return;
  // inhale
  breathEl.style.transitionDuration = inhaleMs + 'ms';
  breathEl.classList.add('big'); breathEl.classList.remove('small','contract');
  await new Promise(res => breathTimer = setTimeout(res, inhaleMs));
  if (!breathing) return;
  // hold (keep big)
  await new Promise(res => breathTimer = setTimeout(res, holdMs));
  if (!breathing) return;
  // exhale
  breathEl.style.transitionDuration = exhaleMs + 'ms';
  breathEl.classList.add('contract'); breathEl.classList.remove('big','small');
  spawnFloatingPaws(6);
  await new Promise(res => breathTimer = setTimeout(res, exhaleMs));
  if (!breathing) return;
  breathEl.classList.remove('contract'); breathEl.classList.add('small');
  await new Promise(res => breathTimer = setTimeout(res, 300));
  if (!breathing) return;
  breatheLoop();
}

btnStart.addEventListener('click', ()=> {
  if (!breathing){
    breathing = true;
    btnStart.textContent = 'Stop Breathing';
    breatheLoop();
  } else {
    breathing = false;
    btnStart.textContent = 'Start Breathing';
    clearTimeout(breathTimer);
    breathEl.classList.remove('big','contract'); breathEl.classList.add('small');
  }
});
btnHow.addEventListener('click', ()=> {
  alert('Breathe gently:\nInhale ‚Äî 7 seconds\nHold ‚Äî 8 seconds\nExhale ‚Äî 4 seconds\nRepeat.');
});

/* -------------------------
  Focus node behavior
------------------------- */
function focusNode(id){
  const el = document.getElementById(id);
  // small highlight
  el.style.transform = 'scale(1.12) translateY(-6px)';
  setTimeout(()=> el.style.transform = '', 700);
  if (id === 'n-play') openPlaylist();
  if (id === 'n-breathe') {
    // scroll into view smoothly and start
    breathEl.scrollIntoView({behavior:'smooth', block:'center'});
    setTimeout(()=> { if (!breathing) btnStart.click(); }, 700);
  }
  if (id === 'n-affirm') rotateAff();
  if (id === 'n-surprise') {
    if (!open) book.click();
    page3.style.transform = 'translateY(6px)';
    setTimeout(()=> page3.style.transform = '', 1300);
  }
}

/* -------------------------
  Create the nodes (DOM already inserted in markup)
------------------------- */
(function createNodesPositions(){
  // ensure nodes exist in DOM with given ids
  nodesRef = nodes = [
    {id:'n-play', angle:-25, r:140},
    {id:'n-breathe', angle:75, r:165},
    {id:'n-affirm', angle:165, r:135},
    {id:'n-surprise', angle:255, r:155}
  ];
  // nodes created earlier in markup loop; nothing else needed
})();

/* -------------------------
  Initial setup & safety
------------------------- */
window.addEventListener('load', ()=> {
  // set resting scale
  breathEl.classList.add('small');
  // set flipbook initially closed
  page1.classList.add('flipped'); page2.classList.add('flipped'); page3.classList.add('flipped');
});

/* cleanup on hide */
document.addEventListener('visibilitychange', ()=> {
  if (document.hidden) {
    breathing=false; clearTimeout(breathTimer);
    if (affHandle) { clearInterval(affHandle); affHandle = null; }
  } else {
    if (!affHandle) affHandle = setInterval(rotateAff, 5000);
  }
});
</script>

</body>
</html>
